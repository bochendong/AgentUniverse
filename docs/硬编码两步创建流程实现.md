# 硬编码两步创建流程实现

## 概述

将 notebook 创建流程硬编码为两部分：
1. **第一步**：调用 `outline_maker_agent` 生成大纲
2. **第二步**：用户确认后，将大纲发送给 master agent 完成 notebook 创建

## 实现内容

### 1. 修改 `create_notebook` 工具 (`backend/tools/agent_tools.py`)

**修改前**：
- 使用 `NotebookCreationRouter` 的 `generate_outline` 方法
- 内部使用 `IntentExtractionAgent` 和 `OutlineMakerAgent`

**修改后**：
- 硬编码直接调用 `outline_maker_agent` 作为工具
- 使用 `tool_registry.create_tool()` 创建 `outline_maker_agent` 工具实例
- 使用 `Runner.run()` 调用 agent 生成大纲

**关键代码**：
```python
# 第一步：使用 outline_maker_agent 生成大纲
registry = get_tool_registry()

# 创建 outline_maker_agent 工具
outline_tool = registry.create_tool(
    "outline_maker_agent",
    agent=master_agent,
    file_path=file_path
)

# 调用 outline_maker_agent 生成大纲
outline_result = await Runner.run(
    outline_tool._agent_instance,
    "请分析文档并生成学习大纲，包括笔记本描述（描述包含什么知识、不包含什么知识、知识边界和定位）"
)

outline = outline_result.final_output
```

### 2. 更新工具元数据

- **工具描述**：更新为"硬编码两步流程"
- **任务说明**：明确说明两步流程
- **输入参数**：`file_path` 改为必需参数（因为 `outline_maker_agent` 需要文件路径）

## 流程说明

### 第一步：生成大纲
1. MasterAgent 调用 `create_notebook` 工具
2. 工具内部创建 `outline_maker_agent` 工具实例
3. 调用 `outline_maker_agent` 生成大纲
4. 返回格式化的 outline 信息供用户确认

### 第二步：创建 Notebook（待实现）
用户确认大纲后，应该：
1. 将确认的大纲发送给 master agent
2. Master agent 使用 `notebook_agent_creator` 工具创建完整内容
3. 创建 `NoteBookAgent` 实例并添加到 master agent 的子 agents 列表

## 优势

1. **流程清晰**：硬编码的两步流程，易于理解和维护
2. **职责分离**：outline 生成和内容创建分离
3. **可扩展性**：可以独立优化每个步骤

## 注意事项

1. **文件路径必需**：`create_notebook` 工具现在需要 `file_path` 参数
2. **错误处理**：添加了详细的错误处理和日志
3. **向后兼容**：保留了原有的返回格式，前端无需修改

## 待完成工作

第二步（用户确认后创建 notebook）的实现：
- 可以修改 `create_notebook_agent` 函数，使其也使用硬编码方式
- 或者创建新的 API 端点处理用户确认后的创建流程
- 使用 `notebook_agent_creator` 作为 agent_as_tool 来完成内容生成

