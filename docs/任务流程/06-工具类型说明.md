# å·¥å…·ç±»å‹è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ AgentUniverse ç³»ç»Ÿä¸­ä¸‰ç§å·¥å…·ç±»å‹çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯ã€‚

## ğŸ“‹ å·¥å…·ç±»å‹æ¦‚è§ˆ

ç³»ç»Ÿä¸­æœ‰ä¸‰ç§ä¸»è¦çš„å·¥å…·ç±»å‹ï¼š

1. **Function Toolï¼ˆå‡½æ•°å·¥å…·ï¼‰**ï¼šç›´æ¥æ‰§è¡Œçš„å‡½æ•°
2. **Agent as Toolï¼ˆä»£ç†ä½œä¸ºå·¥å…·ï¼‰**ï¼šå°† Agent å°è£…ä¸ºå·¥å…·
3. **Agent Communicationï¼ˆAgent é€šä¿¡ï¼‰**ï¼šAgent ä¹‹é—´çš„æ¶ˆæ¯ä¼ é€’

## ğŸ”§ ç±»å‹ä¸€ï¼šFunction Toolï¼ˆå‡½æ•°å·¥å…·ï¼‰

### å®šä¹‰

Function Tool æ˜¯ç›´æ¥æ‰§è¡Œçš„ Python å‡½æ•°ï¼Œä½¿ç”¨ `@function_tool` è£…é¥°å™¨æ ‡è®°ã€‚

### ç‰¹ç‚¹

- âœ… **ç›´æ¥æ‰§è¡Œ**ï¼šå‡½æ•°ç«‹å³æ‰§è¡Œï¼Œä¸éœ€è¦ AI æ¨ç†
- âœ… **ç¡®å®šæ€§**ï¼šç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º
- âœ… **å¿«é€Ÿ**ï¼šæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œæ—  AI è°ƒç”¨å¼€é”€
- âœ… **ç®€å•**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•

### ä½¿ç”¨åœºæ™¯

1. **æ•°æ®æ“ä½œ**ï¼šè¯»å–ã€å†™å…¥ã€ä¿®æ”¹æ•°æ®
2. **æ–‡ä»¶æ“ä½œ**ï¼šä¿å­˜æ–‡ä»¶ã€è¯»å–æ–‡ä»¶
3. **æ•°æ®åº“æ“ä½œ**ï¼šæŸ¥è¯¢ã€æ›´æ–°æ•°æ®åº“
4. **ç®€å•è®¡ç®—**ï¼šä¸éœ€è¦ AI æ¨ç†çš„è®¡ç®—ä»»åŠ¡

### ç¤ºä¾‹

```python
from agents import function_tool

@function_tool
def get_content_by_id(content_id: str) -> str:
    """é€šè¿‡IDè·å–å†…å®¹ä¿¡æ¯"""
    # ç›´æ¥æ‰§è¡Œï¼Œä¸éœ€è¦ AI
    result = locate_by_id(notebook_agent, content_id)
    return json.dumps(result)
```

### æ³¨å†Œæ–¹å¼

```python
@register_function_tool(
    tool_id="get_content_by_id",
    name="get_content_by_id",
    description="é€šè¿‡IDè·å–ç¬”è®°å†…å®¹ä¿¡æ¯",
    task="ç”¨äºæŸ¥çœ‹æŒ‡å®šIDçš„å†…å®¹çš„å½“å‰çŠ¶æ€å’Œç»“æ„",
    agent_types=["NoteBookAgent"],
    input_params={
        "content_id": {"type": "str", "description": "å†…å®¹ID", "required": True},
    },
    output_type="str",
)
def create_get_content_by_id_tool(notebook_agent: 'BaseAgent'):
    @function_tool
    def get_content_by_id(content_id: str) -> str:
        # å®ç°é€»è¾‘
        pass
    return get_content_by_id
```

### å¸¸è§ Function Tools

- `modify_by_id`ï¼šä¿®æ”¹å†…å®¹
- `get_content_by_id`ï¼šè·å–å†…å®¹
- `send_message`ï¼šAgent é—´é€šä¿¡
- `handle_file_upload`ï¼šå¤„ç†æ–‡ä»¶ä¸Šä¼ 
- `create_notebook_with_outline`ï¼šåˆ›å»ºç¬”è®°æœ¬

## ğŸ¤– ç±»å‹äºŒï¼šAgent as Toolï¼ˆä»£ç†ä½œä¸ºå·¥å…·ï¼‰

### å®šä¹‰

Agent as Tool æ˜¯å°†ä¸€ä¸ª Agent å°è£…ä¸ºå·¥å…·ï¼Œè®©å…¶ä»– Agent å¯ä»¥åƒä½¿ç”¨æ™®é€šå·¥å…·ä¸€æ ·ä½¿ç”¨å®ƒã€‚

### ç‰¹ç‚¹

- âœ… **AI æ¨ç†**ï¼šåˆ©ç”¨ Agent çš„ AI èƒ½åŠ›è¿›è¡Œå¤æ‚æ¨ç†
- âœ… **çµæ´»æ€§**ï¼šå¯ä»¥å¤„ç†è‡ªç„¶è¯­è¨€è¾“å…¥
- âœ… **ä¸“ä¸šåŒ–**ï¼šæ¯ä¸ª Agent ä¸“æ³¨äºç‰¹å®šä»»åŠ¡
- âš ï¸ **å¼€é”€**ï¼šéœ€è¦è°ƒç”¨ AIï¼Œæ‰§è¡Œæ—¶é—´è¾ƒé•¿
- âš ï¸ **ä¸ç¡®å®šæ€§**ï¼šç›¸åŒè¾“å…¥å¯èƒ½äº§ç”Ÿä¸åŒè¾“å‡º

### ä½¿ç”¨åœºæ™¯

1. **å†…å®¹ç”Ÿæˆ**ï¼šç”Ÿæˆå¤§çº²ã€ç« èŠ‚å†…å®¹
2. **å†…å®¹ä¼˜åŒ–**ï¼šä¼˜åŒ–ç»ƒä¹ é¢˜ã€è¯æ˜
3. **æ„å›¾è¯†åˆ«**ï¼šåˆ†æç”¨æˆ·æ„å›¾
4. **å†…å®¹ä¿®æ”¹**ï¼šæ ¹æ®è‡ªç„¶è¯­è¨€è¦æ±‚ä¿®æ”¹å†…å®¹

### ç¤ºä¾‹

```python
# åˆ›å»º Agent as Tool
from backend.tools.tool_registry import get_tool_registry
from agents import Runner

registry = get_tool_registry()

# åˆ›å»ºå·¥å…·å®ä¾‹
outline_tool = registry.create_tool(
    "outline_maker_agent",
    agent=master_agent,
    file_path=file_path
)

# ä½¿ç”¨å·¥å…·ï¼ˆéœ€è¦è¿è¡Œ Agentï¼‰
result = await Runner.run(
    outline_tool._agent_instance,
    "è¯·åˆ†ææ–‡æ¡£å¹¶ç”Ÿæˆå­¦ä¹ å¤§çº²"
)

# è·å–ç»“æœ
outline = result.final_output
```

### æ³¨å†Œæ–¹å¼

```python
# 1. å®šä¹‰ Agent ç±»
class OutlineMakerAgent(Agent):
    def __init__(self, file_path: str):
        # Agent åˆå§‹åŒ–
        pass

# 2. æ³¨å†Œä¸º Agent as Tool
metadata = AgentAsToolMetadata(
    tool_id="outline_maker_agent",
    name="outline_maker_agent",
    description="ä»æ–‡ä»¶ç”Ÿæˆå­¦ä¹ å¤§çº²çš„Agent",
    task="åˆ†ææ–‡æ¡£å†…å®¹ï¼Œç”Ÿæˆå­¦ä¹ å¤§çº²",
    agent_types=["AsToolAgent"],
    input_params={
        "file_path": ParamInfo(
            type="str",
            description="æ–‡ä»¶è·¯å¾„",
            required=True
        ),
    },
    output_type="Outline",
    agent_class_name="OutlineMakerAgent",
)
registry.register_agent_as_tool("outline_maker_agent", OutlineMakerAgent, metadata)
```

### å¸¸è§ Agent as Tools

- `outline_maker_agent`ï¼šç”Ÿæˆå¤§çº²
- `intent_extraction_agent`ï¼šæå–æ„å›¾
- `exercise_refinement_agent`ï¼šä¼˜åŒ–ç»ƒä¹ é¢˜
- `proof_refinement_agent`ï¼šä¼˜åŒ–è¯æ˜
- `outline_revision_agent`ï¼šä¿®è®¢å¤§çº²
- `DefinitionModifyAgent`ï¼šä¿®æ”¹å®šä¹‰
- `IntroductionModifyAgent`ï¼šä¿®æ”¹ä»‹ç»

## ğŸ’¬ ç±»å‹ä¸‰ï¼šAgent Communicationï¼ˆAgent é€šä¿¡ï¼‰

### å®šä¹‰

Agent Communication æ˜¯é€šè¿‡ `send_message` å·¥å…·åœ¨ Agent ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æœºåˆ¶ã€‚

### ç‰¹ç‚¹

- âœ… **å±‚çº§ç»“æ„**ï¼šéµå¾ª TopLevelAgent â†’ MasterAgent â†’ NotebookAgent çš„å±‚çº§
- âœ… **ä»»åŠ¡åˆ†å‘**ï¼šMasterAgent å¯ä»¥å°†ä»»åŠ¡åˆ†å‘ç»™å­ Agent
- âœ… **è§£è€¦**ï¼šAgent ä¹‹é—´æ¾è€¦åˆï¼Œæ˜“äºæ‰©å±•
- âš ï¸ **å¼€é”€**ï¼šéœ€è¦åŠ è½½å’Œè¿è¡Œç›®æ ‡ Agent

### ä½¿ç”¨åœºæ™¯

1. **ä»»åŠ¡åˆ†å‘**ï¼šMasterAgent å°†ä»»åŠ¡åˆ†å‘ç»™ NotebookAgent
2. **æŸ¥è¯¢å†…å®¹**ï¼šæŸ¥è¯¢ç‰¹å®šç¬”è®°æœ¬çš„å†…å®¹
3. **ä¿®æ”¹å†…å®¹**ï¼šåœ¨ç‰¹å®šç¬”è®°æœ¬ä¸­ä¿®æ”¹å†…å®¹
4. **åè°ƒå·¥ä½œ**ï¼šå¤šä¸ª Agent åä½œå®Œæˆå¤æ‚ä»»åŠ¡

### ç¤ºä¾‹

```python
# TopLevelAgent å‘ MasterAgent å‘é€æ¶ˆæ¯
result = send_message(
    id=master_agent_id,
    message="è¯·æŸ¥è¯¢å…³äº'ç¾¤è®º'çš„ç¬”è®°æœ¬å†…å®¹"
)

# MasterAgent å‘ NotebookAgent å‘é€æ¶ˆæ¯
result = send_message(
    id=notebook_agent_id,
    message="è¯·åœ¨ç¬¬ä¸€ç« æ·»åŠ ä¸€ä¸ªæ–°çš„å®šä¹‰"
)
```

### å®ç°æ–¹å¼

`send_message` æœ¬èº«æ˜¯ä¸€ä¸ª Function Toolï¼Œä½†å®ƒç”¨äºè§¦å‘ Agent ä¹‹é—´çš„é€šä¿¡ï¼š

```python
@function_tool
def send_message(id: str, message: str) -> str:
    """å‘æŒ‡å®šIDçš„agentå‘é€æ¶ˆæ¯"""
    # 1. åŠ è½½ç›®æ ‡ Agent
    target_agent = wake_agent(id, db_path=agent.DB_PATH)
    
    # 2. å‘é€æ¶ˆæ¯å¹¶è·å–å“åº”
    output = agent.run_async_safely(
        target_agent.receive_messgae(message)
    )
    
    return str(output)
```

## ğŸ“Š ä¸‰ç§ç±»å‹å¯¹æ¯”

| ç‰¹æ€§ | Function Tool | Agent as Tool | Agent Communication |
|------|--------------|---------------|---------------------|
| **æ‰§è¡Œæ–¹å¼** | ç›´æ¥æ‰§è¡Œå‡½æ•° | è¿è¡Œ Agent | å‘é€æ¶ˆæ¯ç»™ Agent |
| **AI è°ƒç”¨** | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ | âœ… éœ€è¦ |
| **æ‰§è¡Œé€Ÿåº¦** | âš¡ å¿« | ğŸ¢ æ…¢ | ğŸ¢ æ…¢ |
| **ç¡®å®šæ€§** | âœ… ç¡®å®š | âŒ ä¸ç¡®å®š | âŒ ä¸ç¡®å®š |
| **å¤æ‚åº¦** | ç®€å• | å¤æ‚ | ä¸­ç­‰ |
| **ä½¿ç”¨åœºæ™¯** | æ•°æ®æ“ä½œ | å†…å®¹ç”Ÿæˆ/ä¼˜åŒ– | ä»»åŠ¡åˆ†å‘ |
| **ç¤ºä¾‹** | `modify_by_id` | `outline_maker_agent` | `send_message` |

## ğŸ”„ ç»„åˆä½¿ç”¨

åœ¨å®é™…ä»»åŠ¡ä¸­ï¼Œä¸‰ç§å·¥å…·ç±»å‹ç»å¸¸ç»„åˆä½¿ç”¨ï¼š

### ç¤ºä¾‹ï¼šåˆ›å»ºç¬”è®°æœ¬

```
1. Function Tool: handle_file_upload
   â†“
2. Agent as Tool: intent_extraction_agent
   â†“
3. Function Tool: create_notebook_from_outline
   â†“
4. Agent Communication: send_message (MasterAgent â†’ NotebookAgent)
   â†“
5. Agent as Tool: exercise_refinement_agent
   â†“
6. Function Tool: modify_by_id
```

## ğŸ”‘ é€‰æ‹©æŒ‡å—

### ä½•æ—¶ä½¿ç”¨ Function Toolï¼Ÿ

- âœ… ä¸éœ€è¦ AI æ¨ç†
- âœ… éœ€è¦å¿«é€Ÿæ‰§è¡Œ
- âœ… é€»è¾‘ç®€å•æ˜ç¡®
- âœ… éœ€è¦ç¡®å®šæ€§ç»“æœ

### ä½•æ—¶ä½¿ç”¨ Agent as Toolï¼Ÿ

- âœ… éœ€è¦ AI æ¨ç†
- âœ… éœ€è¦å¤„ç†è‡ªç„¶è¯­è¨€
- âœ… ä»»åŠ¡å¤æ‚ï¼Œéœ€è¦å¤šæ­¥æ¨ç†
- âœ… éœ€è¦ç”Ÿæˆæˆ–ä¼˜åŒ–å†…å®¹

### ä½•æ—¶ä½¿ç”¨ Agent Communicationï¼Ÿ

- âœ… éœ€è¦ä»»åŠ¡åˆ†å‘
- âœ… éœ€è¦è·¨ Agent åä½œ
- âœ… éœ€è¦æŸ¥è¯¢æˆ–ä¿®æ”¹å…¶ä»– Agent çš„å†…å®¹
- âœ… éµå¾ªå±‚çº§ç»“æ„

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¯ä»¥åˆ›å»ºä¸€ä¸ªæ—¢æ˜¯ Function Tool åˆæ˜¯ Agent as Tool çš„å·¥å…·å—ï¼Ÿ
A: æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†ä¸æ¨èã€‚åº”è¯¥æ ¹æ®ä»»åŠ¡ç‰¹æ€§é€‰æ‹©ä¸€ç§ç±»å‹ã€‚

### Q: Agent as Tool å’Œç›´æ¥åˆ›å»º Agent æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: 
- **Agent as Tool**ï¼šé€šè¿‡å·¥å…·ç³»ç»Ÿç®¡ç†ï¼Œå¯ä»¥åŠ¨æ€åˆ›å»ºï¼Œæœ‰ç»Ÿä¸€çš„æ¥å£
- **ç›´æ¥åˆ›å»º Agent**ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œä¸å¤Ÿçµæ´»

### Q: send_message æ˜¯ Function Tool è¿˜æ˜¯ Agent Communicationï¼Ÿ
A: `send_message` æœ¬èº«æ˜¯ Function Toolï¼Œä½†å®ƒç”¨äºå®ç° Agent Communication æœºåˆ¶ã€‚

### Q: å¦‚ä½•å†³å®šä½¿ç”¨å“ªç§å·¥å…·ç±»å‹ï¼Ÿ
A: æ ¹æ®ä»»åŠ¡ç‰¹æ€§ï¼š
- **ç®€å•æ“ä½œ** â†’ Function Tool
- **éœ€è¦ AI æ¨ç†** â†’ Agent as Tool
- **éœ€è¦ä»»åŠ¡åˆ†å‘** â†’ Agent Communication

