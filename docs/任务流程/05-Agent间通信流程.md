# Agent é—´é€šä¿¡æµç¨‹

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°ç³»ç»Ÿä¸­ Agent ä¹‹é—´çš„é€šä¿¡æœºåˆ¶å’Œä»»åŠ¡åˆ†å‘æµç¨‹ã€‚

## ğŸ“‹ æµç¨‹æ¦‚è§ˆ

AgentUniverse é‡‡ç”¨ä¸‰å±‚ Agent æ¶æ„ï¼ŒAgent ä¹‹é—´é€šè¿‡ `send_message` å·¥å…·è¿›è¡Œé€šä¿¡ï¼š

```
TopLevelAgent (é¡¶å±‚å…¥å£)
    â†“ send_message
MasterAgent (ä¸­é—´åè°ƒè€…)
    â†“ send_message
NotebookAgent (ç¬”è®°æœ¬ç®¡ç†è€…)
```

## ğŸ¯ åœºæ™¯ä¸€ï¼šTopLevelAgent â†’ MasterAgent

### è§¦å‘æ–¹å¼ï¼š**By Tool** (send_message)

### è¯¦ç»†æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ï¼ˆéåˆ›å»ºç¬”è®°æœ¬ä»»åŠ¡ï¼‰
    â†“
TopLevelAgent æ¥æ”¶è¯·æ±‚
    â†“
åˆ†æè¯·æ±‚ï¼Œç¡®å®šä»»åŠ¡ç±»å‹
    â†“
è°ƒç”¨ send_message (Function Tool)
    â†“
å‘é€æ¶ˆæ¯ç»™ MasterAgent
    â†“
MasterAgent å¤„ç†è¯·æ±‚
    â†“
è¿”å›ç»“æœç»™ TopLevelAgent
    â†“
TopLevelAgent è¿”å›ç»™ç”¨æˆ·
```

### å…³é”®å·¥å…·

#### `send_message` (Function Tool)
- **ä½ç½®**ï¼š`backend/tools/function_tools/communication_tools.py`
- **è§¦å‘è€…**ï¼šTopLevelAgent
- **åŠŸèƒ½**ï¼šå‘æŒ‡å®š ID çš„ Agent å‘é€æ¶ˆæ¯å¹¶è·å–å“åº”
- **å‚æ•°**ï¼š
  - `id`ï¼šç›®æ ‡ Agent çš„å®Œæ•´ UUID
  - `message`ï¼šè¦å‘é€çš„æ¶ˆæ¯å†…å®¹

### ä»£ç ç¤ºä¾‹

```python
# TopLevelAgent ä½¿ç”¨ send_message
@function_tool
def send_message(id: str, message: str) -> str:
    """å‘æŒ‡å®šIDçš„agentå‘é€æ¶ˆæ¯"""
    # 1. åŠ è½½ç›®æ ‡ Agent
    target_agent = wake_agent(id, db_path=agent.DB_PATH)
    
    # 2. å‘é€æ¶ˆæ¯å¹¶è·å–å“åº”
    output = agent.run_async_safely(
        target_agent.receive_messgae(message)
    )
    
    return str(output)
```

### ä½¿ç”¨åœºæ™¯

1. **æŸ¥è¯¢ç¬”è®°æœ¬å†…å®¹**ï¼šç”¨æˆ·è¯¢é—®æŸä¸ªç¬”è®°æœ¬çš„å†…å®¹
2. **æ·»åŠ å†…å®¹**ï¼šç”¨æˆ·è¦æ±‚åœ¨ç¬”è®°æœ¬ä¸­æ·»åŠ æ–°å†…å®¹
3. **ä¿®æ”¹å†…å®¹**ï¼šç”¨æˆ·è¦æ±‚ä¿®æ”¹ç¬”è®°æœ¬çš„æŸä¸ªéƒ¨åˆ†
4. **ä»»åŠ¡åˆ†å‘**ï¼šå°†å¤æ‚ä»»åŠ¡åˆ†å‘ç»™ MasterAgent å¤„ç†

## ğŸ¯ åœºæ™¯äºŒï¼šMasterAgent â†’ NotebookAgent

### è§¦å‘æ–¹å¼ï¼š**By Tool** (send_message)

### è¯¦ç»†æµç¨‹

```
MasterAgent æ¥æ”¶ä»»åŠ¡
    â†“
åˆ†æä»»åŠ¡ï¼Œæå–å…³é”®è¯
    â†“
æŸ¥çœ‹å­ Agent åˆ—è¡¨
    â†“
æ‰¾åˆ°åŒ¹é…çš„ NotebookAgent
    â†“
è°ƒç”¨ send_message (Function Tool)
    â†“
å‘é€æ¶ˆæ¯ç»™ NotebookAgent
    â†“
NotebookAgent å¤„ç†è¯·æ±‚
    â†“
è¿”å›ç»“æœç»™ MasterAgent
    â†“
MasterAgent æ•´åˆç»“æœå¹¶è¿”å›
```

### å…³é”®å·¥å…·

#### `send_message` (Function Tool)
- **ä½ç½®**ï¼š`backend/tools/function_tools/communication_tools.py`
- **è§¦å‘è€…**ï¼šMasterAgent
- **åŠŸèƒ½**ï¼šå‘å­ NotebookAgent å‘é€æ¶ˆæ¯
- **ä½¿ç”¨åœºæ™¯**ï¼š
  - æŸ¥è¯¢ç‰¹å®šç¬”è®°æœ¬çš„å†…å®¹
  - åœ¨ç‰¹å®šç¬”è®°æœ¬ä¸­æ·»åŠ /ä¿®æ”¹å†…å®¹
  - è·å–ç¬”è®°æœ¬çš„è¯¦ç»†ä¿¡æ¯

### ä»£ç ç¤ºä¾‹

```python
# MasterAgent ä½¿ç”¨ send_message
# 1. åˆ†æä»»åŠ¡ï¼Œæ‰¾åˆ°åŒ¹é…çš„ NotebookAgent
matching_agent_id = find_matching_notebook_agent(task_keywords)

# 2. å‘é€æ¶ˆæ¯
result = send_message(
    id=matching_agent_id,
    message=f"è¯·å¤„ç†ä»¥ä¸‹ä»»åŠ¡ï¼š{task_description}"
)

# 3. è¿”å›ç»“æœ
return result
```

### ä»»åŠ¡åˆ†å‘é€»è¾‘

MasterAgent çš„ä»»åŠ¡åˆ†å‘é€»è¾‘ï¼š

1. **å…³é”®è¯åŒ¹é…**ï¼šæå–ä»»åŠ¡ä¸­çš„å…³é”®è¯
2. **Agent åˆ—è¡¨æŸ¥è¯¢**ï¼šæŸ¥çœ‹ç®¡ç†çš„å­ Agent åˆ—è¡¨
3. **åŒ¹é…åˆ¤æ–­**ï¼š
   - å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ NotebookAgent â†’ ä½¿ç”¨ `send_message` è½¬å‘
   - å¦‚æœæ²¡æœ‰åŒ¹é…çš„ Agent â†’ è€ƒè™‘åˆ›å»ºæ–°çš„ NotebookAgent
4. **ç»“æœæ•´åˆ**ï¼šæ¥æ”¶ Agent å›å¤ï¼Œæ•´åˆåè¿”å›ç»™ä¸Šçº§

## ğŸ¯ åœºæ™¯ä¸‰ï¼šNotebookAgent å†…éƒ¨å¤„ç†

### è§¦å‘æ–¹å¼ï¼š**By Tool** (å†…éƒ¨å·¥å…·)

### è¯¦ç»†æµç¨‹

```
NotebookAgent æ¥æ”¶æ¶ˆæ¯
    â†“
åˆ†ææ¶ˆæ¯å†…å®¹
    â†“
è¯†åˆ«ä»»åŠ¡ç±»å‹
    â†“
è°ƒç”¨ç›¸åº”çš„å·¥å…·ï¼š
  - modify_by_idï¼šä¿®æ”¹å†…å®¹
  - get_content_by_idï¼šè·å–å†…å®¹
  - æˆ–å…¶ä»–ä¸“ç”¨å·¥å…·
    â†“
æ‰§è¡Œæ“ä½œ
    â†“
è¿”å›ç»“æœ
```

### NotebookAgent çš„å·¥å…·

NotebookAgent å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

1. **`modify_by_id`**ï¼šé€šè¿‡ ID ä¿®æ”¹å†…å®¹
2. **`get_content_by_id`**ï¼šé€šè¿‡ ID è·å–å†…å®¹
3. **`send_message`**ï¼šå‘å…¶ä»– Agent å‘é€æ¶ˆæ¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ“Š å®Œæ•´é€šä¿¡æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¯·æ±‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TopLevelAgent   â”‚
â”‚                 â”‚
â”‚ 1. æ¥æ”¶è¯·æ±‚      â”‚
â”‚ 2. åˆ†ææ„å›¾      â”‚
â”‚ 3. åˆ¤æ–­ä»»åŠ¡ç±»å‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºç¬”è®°æœ¬ä»»åŠ¡   â”‚  â”‚ å…¶ä»–ä»»åŠ¡         â”‚
â”‚                 â”‚  â”‚                 â”‚
â”‚ ä½¿ç”¨ä¸“ç”¨å·¥å…·     â”‚  â”‚ send_message     â”‚
â”‚ (generate_      â”‚  â”‚                 â”‚
â”‚  outlineç­‰)     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ MasterAgent     â”‚
                    â”‚                 â”‚
                    â”‚ 1. æ¥æ”¶æ¶ˆæ¯      â”‚
                    â”‚ 2. åˆ†æä»»åŠ¡      â”‚
                    â”‚ 3. æŸ¥æ‰¾åŒ¹é… Agentâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼ (send_message)
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ NotebookAgent   â”‚
                    â”‚                 â”‚
                    â”‚ 1. æ¥æ”¶æ¶ˆæ¯      â”‚
                    â”‚ 2. è°ƒç”¨å·¥å…·      â”‚
                    â”‚ 3. æ‰§è¡Œæ“ä½œ      â”‚
                    â”‚ 4. è¿”å›ç»“æœ      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ å…³é”®è¦ç‚¹

1. **send_message æ˜¯æ ¸å¿ƒ**ï¼šæ‰€æœ‰ Agent é—´é€šä¿¡éƒ½é€šè¿‡ `send_message` å·¥å…·
2. **ID å¿…é¡»å®Œæ•´**ï¼šå‘é€æ¶ˆæ¯æ—¶å¿…é¡»ä½¿ç”¨å®Œæ•´çš„ Agent UUID
3. **å·¥å…·æ¢å¤**ï¼šä½¿ç”¨ `wake_agent` ç¡®ä¿ Agent çš„å·¥å…·å·²æ¢å¤
4. **é”™è¯¯å¤„ç†**ï¼šå¦‚æœ Agent ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯
5. **å¼‚æ­¥å®‰å…¨**ï¼šä½¿ç”¨ `run_async_safely` ç¡®ä¿å¼‚æ­¥æ“ä½œå®‰å…¨æ‰§è¡Œ

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ‰¾åˆ°æ­£ç¡®çš„ Agent IDï¼Ÿ
A: Agent ID å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–ï¼š
- æŸ¥çœ‹ Agent åˆ—è¡¨ï¼ˆé€šè¿‡ `get_all_agent_info`ï¼‰
- ä»æ•°æ®åº“æŸ¥è¯¢
- ä»çˆ¶ Agent çš„ `sub_agent_ids` è·å–

### Q: send_message å’Œç›´æ¥è°ƒç”¨ Agent æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: 
- **send_message**ï¼šé€šè¿‡å·¥å…·ç³»ç»Ÿï¼Œä¼šè§¦å‘ Agent çš„ `receive_messgae` æ–¹æ³•ï¼Œç¡®ä¿å·¥å…·å·²æ¢å¤
- **ç›´æ¥è°ƒç”¨**ï¼šå¯èƒ½ç¼ºå°‘å·¥å…·æ¢å¤æ­¥éª¤ï¼Œä¸æ¨è

### Q: å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ NotebookAgent æ€ä¹ˆåŠï¼Ÿ
A: MasterAgent å¯ä»¥ï¼š
1. åˆ›å»ºæ–°çš„ NotebookAgent
2. è¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦åˆ›å»ºæ–°ç¬”è®°æœ¬
3. è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæç¤ºç”¨æˆ·å…ˆåˆ›å»ºç¬”è®°æœ¬

### Q: æ¶ˆæ¯æ ¼å¼æœ‰è¦æ±‚å—ï¼Ÿ
A: æ²¡æœ‰ä¸¥æ ¼æ ¼å¼è¦æ±‚ï¼Œä½†å»ºè®®ï¼š
- æ¸…æ™°æè¿°ä»»åŠ¡
- åŒ…å«å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼Œä¾¿äº Agent ç†è§£

### Q: å¯ä»¥è·¨å±‚çº§å‘é€æ¶ˆæ¯å—ï¼Ÿ
A: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å»ºè®®éµå¾ªå±‚çº§ç»“æ„ï¼š
- TopLevelAgent â†’ MasterAgent â†’ NotebookAgent
- é¿å…è·¨å±‚çº§ç›´æ¥é€šä¿¡

